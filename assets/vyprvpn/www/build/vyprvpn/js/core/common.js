function manipulateAddTemplateDiv(){var a=document.getElementsByTagName("body")[0],b=document.createElement("div");return a?(b.id="templates",b.setAttribute("aria-hidden","true"),b.setAttribute("hidden","hidden"),void a.appendChild(b)):void log.error("Cannot `manipulateAddTemplateDiv` because bindEl is not found.")}function Vypr(){this.constants={view:{lowest:1,pending:1,login:2,not_connected:3,connecting:4,connected:5,fail_connected:6,disconnecting:7,offline:8,updating:9,no_internet:10,highest:10},re:{stringReplace:/X|tpl/g,NoNumberAttrSegmentFind:/vypr--device-([A-Za-z-]+)-/},elementStatus:["progress","warning","error","success"],className:{active:"is-active",invalid:"is-invalid",status:"is-status",progress:"is-pending",warning:"is-warning",error:"is-error",success:"is-success",notice:"is-notice",statusPrefix:"has-status-",debug:"is-debug"},query:{upgrade:{status:"upgradeStatus",type:"upgradeType"}},upgrade:{no_internet:"no_internet",not_upgrading:"not_upgrading",uploading:"uploading",requesting:"requesting",downloading:"downloading",rebooting:"rebooting",restarting:"restarting",flashing:"flashing",failed:"failed",progress:"progress",complete:"complete"},upgradeTypes:["app"],message:{general:{error:{unknown:"Unexpected error. Please reboot your router.",offline:"VyprVPN Router App is offline. Please reboot your router.",no_comm:"Unable to communicate with VyprVPN Router App. Please reboot your router.",no_response:"Unable to communicate with VyprVPN Router App. Please check your internet connection, and reboot your router.",bad_data:"VyprVPN Router App not responding as expected. Please reboot your router."},warning:{init:"VyprVPN Router App is starting...",offline:"VyprVPN Router App is offline. If an upgrade is not in progress, please reboot your router."}},upgrade:{error:{app:"VyprVPN Router App update was unsuccessful.",any:"VyprVPN Router App update was unsuccessful.",unknown:"Update status is unavailable. Please restart update process if necessary.",no_internet:"Your internet connection was lost during the update process, please try again.",timeout:"VyprVPN Router App is taking too long to respond. The upgrade may be complete. Do you want to reload the page?"},warning:{excessive_wait:"Process is taking longer than expected."},success:{app:"VyprVPN Router App update was successful!",any:"VyprVPN Router App update was successful!"},confirmation:{app:"Are you sure you want to update to VyprVPN Router App Version: %s?",disconnect:"Your active VPN connection will be disconnected."}},authentication:{confirmation:{disconnect:"VyprVPN is currently connected. Your router will disconnect from VyprVPN if you log out."}}}},this.cache={updateUi:{}},this.g_offline_count=0,this.g_bad_data_count=0,this.g_current_failure="",this.g_current_view=void 0,this.g_timeout=20,this.g_timeout_count=0,this.g_timeout_limit=9,this.g_get_status_interval=void 0,this.g_get_status_delay=5,this.g_get_status_count=0,this.g_get_upgrade_status_interval=void 0,this.g_get_upgrade_status_delay_initial=0,this.g_get_upgrade_status_delay=VYPR_CONSTANT.GET_STATUS_UPGRADE_DELAY,this.g_upgrading_status_time_elapsed=0,this.g_upgrading_status_time_limit=30,this.g_upgrading_previous_status="",this.g_get_upgrade_refresh_delay=3,this.g_time_connected_seconds=-1,this.g_time_connected_timestamp=-1,this.g_time_connected_delay=1,this.g_time_connected_interval=void 0,this.g_upgrading=!1,this.g_upgrading_type="",this.g_upgrading_active=!1,this.g_upgrading_progress=void 0,this.g_upgrading_template="",this.g_loaded_templates=[],this.g_loaded_scripts=[],this.g_cgi_port="",this.g_window_state_unload=!1,this.g_events_handled_count=0,this.g_first_show=!0,this.g_protocol_text={Chameleon:{name:"Chameleonâ„¢ - 256-bit Encryption",description:"Without sacrificing speed or security, our Chameleon technology masks VPN traffic so it cannot be identified as a VPN connection and blocked or throttled. Chameleon uses the unmodified OpenVPN 256-bit protocol for the underlying data encryption."},"OpenVPN-256":{name:"OpenVPN - 256-bit Encryption",description:"The premier VPN protocol. Best performing protocol with fastest speeds, even on connections with high latency and across great distances. Most reliable and stable protocol, even behind wireless routers, on non-reliable networks and on Wi-Fi hotspots."},"OpenVPN-160":{name:"OpenVPN - 160-bit Encryption",description:"Less secure than OpenVPN - 256 bit encryption. Trades decreased encryption strength for faster speeds."},PPTP:{name:"PPTP - 128-bit Encryption",description:"Provides basic security. Slightly faster due to 128 bit encryption. A good choice if security is not a top priority. PPTP has built-in support by most desktop, mobile and tablet devices."}},this.g_enable_fields_ids=[]}var VYPR_CONSTANT={DEBUG:!0,FAIL_QUIET:!1,FAIL_UI_DISABLE:!1,GET_STATUS_UPGRADE_DELAY:1},VYPR_CONSTANT_PRODUCTION={DEBUG:!1,FAIL_QUIET:!1,FAIL_UI_DISABLE:!1,GET_STATUS_UPGRADE_DELAY:1};for(var value in VYPR_CONSTANT_PRODUCTION)void 0!==VYPR_CONSTANT[value]?VYPR_CONSTANT[value]!==VYPR_CONSTANT_PRODUCTION[value]&&console.warn("Vypr constant value `"+value+"` is set to `"+VYPR_CONSTANT[value]+"`. Production value is `"+VYPR_CONSTANT_PRODUCTION[value]+"`."):VYPR_CONSTANT[value]=VYPR_CONSTANT_PRODUCTION[value];var log={output:function(a,b){if(VYPR_CONSTANT.DEBUG)switch(b){case"error":"object"==typeof a&&a.hasOwnProperty("stack")?console.error(a.stack):console.error(a);break;case"warn":console.warn(a);break;case"log":console.log(a);break;case"info":console.info(a)}},status:function(a){log.output(":status: "+a,"log")},success:function(a){log.output(":success: "+a,"log")},cache:function(a,b){log.output(":cache: {"+a+": "+JSON.stringify(b)+"}","info")},storage:function(a,b){log.output(":storage: {"+a+": "+JSON.stringify(b)+"}","info")},error:function(a,b){log.output(":error: "+a,"error"),b&&log.output(b,"info")},warn:function(a,b){arguments.length>=2?log.smart(a,"warn",b):log.smart(a,"warn")},info:function(a,b){arguments.length>=2?log.smart(a,"info",b):log.smart(a,"info")},smart:function(a,b,c){switch(typeof a){case"string":case"number":log.output(":"+b+": "+a,b);break;default:log.output(":"+b+":",b),log.output(a,b)}arguments.length>=3&&(log.output(":"+b+":",b),log.output(c,b))}};VyprElementHelper.isNodeOfCurrentDocument=function(a){var b=a&&a.hasOwnProperty("nodeType"),c=b&&a.nodeType===Node.ELEMENT_NODE,d=b&&a.nodeType===Node.DOCUMENT_NODE;return!(!c||a.ownerDocument!==document)||!(!d||a!==document)},VyprElementHelper.addClass=function(a,b){var c="string"==typeof a?document.getElementById(a):a;if(!c||!c.nodeType)return void log.warn("Element is not a node in `addClass`.");for(var d=(a.className||"").split(/\s+/),e=0,f=1;f<arguments.length;++f)d.find(arguments[f])==-1&&(d.push(arguments[f]),e=1);e&&(a.className=d.join(" "))},VyprElementHelper.removeClass=function(a,b){var c="string"==typeof a?document.getElementById(a):a;if(!c||!c.nodeType)return void log.warn("Element is not a node in `removeClass`.");for(var d=(a.className||"").split(/\s+/),e=0,f=1;f<arguments.length;++f)e|=d.remove(arguments[f]);e&&(a.className=d.join(" "))},VyprElementHelper.addClasses=function(a,b,c){var d="string"==typeof a?document.getElementById(a):a;return d&&d.nodeType?void b.forEach(function(a){VyprElementHelper.addClass(d,c+a)}):void log.warn("Element is not a node in `addClasses`.")},VyprElementHelper.removeClasses=function(a,b,c){var d="string"==typeof a?document.getElementById(a):a;return d&&d.nodeType?void b.forEach(function(a){VyprElementHelper.removeClass(d,c+a)}):void log.warn("Element is not a node in `removeClasses`.")},VyprElementHelper.setAttributeBoolean=function(a,b,c){for(var d=Array.isArray(a)?a:[element],e=0;e<d.length;e++){var f=d[e];f&&(c?f.setAttribute(b,b):f.removeAttribute(b))}},VyprElementHelper.querySelectorClosest=function(a,b){var c="string"==typeof a?document.getElementById(a):a,d=a.querySelector(b);return c&&c.nodeType?a&&(d?a:VyprElementHelper.querySelectorClosest(a.parentNode,b)):void log.warn("Element is not a node in `querySelectorClosest`.")},VyprElementHelper.css=function(a,b){var c="string"==typeof a?document.getElementById(a):a;return getComputedStyle(c).getPropertyValue(b)},VyprElementHelper.setChecked=function(a,b){var c="string"==typeof a?document.getElementById(a):a;return c&&c.nodeType?void(b?(c.checked=!0,c.setAttribute("checked","checked")):(c.checked=!1,c.removeAttribute("checked"))):void log.warn("Element is not a node in `setChecked`.")},VyprElementHelper.getIndex=function(a){var b="string"==typeof a?document.getElementById(a):a;return b&&b.nodeType?Array.prototype.indexOf.call(b.parentNode.childNodes,b):(log.warn("Element is not a node in `getIndex`."),-1)},VyprElementHelper.setTextContentMultiple=function(a){a.forEach(function(a){VyprElementHelper.setTextContent(a[0],a[1])})},VyprElementHelper.emptyNode=function(a){for(var b="string"==typeof a?document.getElementById(a):a;b.hasChildNodes();)b.removeChild(b.firstChild);return b},VyprElementHelper.appendChildArray=function(a,b,c){var d,e="string"==typeof a?document.getElementById(a):a;return c&&VyprElementHelper.emptyNode(e),b.forEach(function(a){d="string"==typeof a?document.getElementById(a):a,e.appendChild(d)}),e},VyprElementHelper.buildOptions=function(a,b){var c,d,e,f,g=[];return a.forEach(function(a){c=a[0]||"",d=a[1]||a[0]||"",e=a[2]||"",f=document.createElement("option"),f.setAttribute("value",c),""!==e&&f.setAttribute("title",e),c==b&&f.setAttribute("selected","selected"),t=document.createTextNode(d),f.appendChild(t),g.push(f)}),g},VyprElementHelper.setSelectedIndexByValue=function(a,b){var c,d,e="string"==typeof a?document.getElementById(a):a;if(!e||!e.nodeType)return void log.warn("Element is not a node in `setSelectedIndexByValue`.");if(null==e.options||null==e.selectedIndex)return void log.warn("Element is not a select element in `setSelectedIndexByValue`.");for(c=0,d=e.options.length;c<d;++c)e.options[c].value==b?(e.selectedIndex=c,e.options[c].setAttribute("selected","selected")):e.options[c].removeAttribute("selected")},VyprElementHelper.getSelectedIndexValue=function(a){var b="string"==typeof a?document.getElementById(a):a;return b&&b.nodeType?null==b.options||null==b.selectedIndex?void log.warn("Element is not a select element in `getSelectedIndexValue`."):b.options.length&&b.selectedIndex!==-1?b.options[b.selectedIndex].value:void log.warn("Select element has no options or index in `getSelectedIndexValue`."):void log.warn("Element is not a node in `getSelectedIndexValue`.")},VyprElementHelper.setCheckedRadioByValue=function(a,b){var c=document.getElementsByName(a);if(c.length<0)return void log.warn("No nodes found in `setCheckedRadioByValue`.");for(var d=0,e=c.length;d<e;++d){var f=c[d];f.value===b.toString()?(f.setAttribute("checked","checked"),f.checked=!0):(f.removeAttribute("checked"),f.checked=!1)}},VyprElementHelper.getElementById=function(a,b){var c,d="string"==typeof a?document.getElementById(a):a,e=null;if(!d||!d.nodeType)return log.warn("Element is not a node in `getElementById`."),d;if(d.getAttribute("id")==b)return d;for(c=0;c<d.childNodes.length&&(1!=d.childNodes[c].nodeType||(e=VyprElementHelper.getElementById(d.childNodes[c],b),null===e));c++);return e},VyprElementHelper.getElementsByClassName=function(a,b,c){c=c||"*",f=a||document;var d,e,f="string"==typeof a?document.getElementById(a):a,g=null,h=[],i=f.getElementsByTagName(c);for(d=0,e=i.length;d<e;++d)g=i[d],VyprElementHelper.hasClass(g,b)&&(h[h.length]=i[d]);return h},VyprElementHelper.hasClass=function(a,b){var c="string"==typeof a?document.getElementById(a):a,d=/[\t\r\n\f]/g;return b=" "+b+" ",c&&c.nodeType?1===c.nodeType&&(" "+c.className+" ").replace(d," ").indexOf(b)>=0:void log.warn("Element is not a node in `hasClass`.")},VyprElementHelper.removeWhitespace=function(a){var b="string"==typeof a?document.getElementById(a):a;return b&&b.nodeType?(clean=function(a){for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];8===c.nodeType||3===c.nodeType&&!/\S/.test(c.nodeValue)?(a.removeChild(c),b--):1===c.nodeType&&clean(c)}},void clean(b)):void log.warn("Element is not a node in `removeWhitespace`.")};var evt={};evt.stopPropagation=function(a){a&&(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},evt.preventDefault=function(a){a&&(a.preventDefault?a.preventDefault():a.returnValue=!1)};var html5={};html5.support={inputAttribute:function(a){var b=document.createElement("input");return a.toString()in b}},Vypr.prototype.messageSendToContentPage=function(a,b){var c=this.getVyprContentPage();c&&this.messageSend(a,b,c)},Vypr.prototype.messageSendToFramePage=function(a,b){var c=this.getVyprFramePage();c&&this.messageSend(a,b,c)},Vypr.prototype.messageSendToSelf=function(a,b){this.messageSend(a,b,window)},Vypr.prototype.messageSend=function(a,b,c){var d=VyprUrlHelper.getWindowLocationOrigin((c||window).location),e={id:a,data:b};e=JSON.stringify(e),log.info("Sending message `"+a+"` with data:",e),(c||window).postMessage(e,d)},Vypr.prototype.messageReceive=function(a,b,c){var d=VyprUrlHelper.getWindowLocationOrigin((c||window).location);return"function"!=typeof b?void log.warn("Received message but callback is not a function.",b):void window.addEventListener("message",function(c){try{var e=JSON.parse(c.data)}catch(a){return void log.warn("Received invalid event data:",c.data)}return c.origin!==d?void log.warn("Received message from unknown origin: `"+c.origin+"`"):a!==e.id?void log.status("Ignoring message `"+e.id+"` because it does not match `"+a+"`."):(log.status("Received message `"+e.id+"`."),void b(e.data))})},Vypr.prototype.handleMessageExample=function(){function a(a){log.info("Handle message.",a)}this.messageReceive("vypr.example.message.handle",a,window)},Vypr.prototype.isVyprPage=function(a){return(a||window).location.pathname.search("/vyprvpn")!==-1},Vypr.prototype.isVyprStyle=function(){return"ext/custom"===this.getCache("user_css")},Vypr.prototype.isVyprContentPage=function(a){return(a||window).location.pathname.search("/vyprvpn/")!==-1},Vypr.prototype.isVyprFramePage=function(a){return this.isVyprPage(a||window)&&!this.isVyprContentPage(a||window)},Vypr.prototype.isFrameContentPage=function(a){return(a||window).top.location.pathname!==(a||window).location.pathname},Vypr.prototype.getVyprContentPage=function(){var a=document.getElementById("vypr--iframe");return a?a.contentWindow:null},Vypr.prototype.getVyprFramePage=function(){var a=window.parent.location.pathname===window.location.pathname;return a?null:window.parent},Vypr.prototype.getPageName=function(){var a=window.location.pathname.replace(/\/(.+)\//,""),b=a.substr(0,a.lastIndexOf("."));return b},Vypr.prototype.doUpgradeRefresh=function(a,b){var c=this,d=b?"complete":"failed",e=window.location.href;window.setTimeout(function(){e=VyprUrlHelper.addUpdateParam(c.constants.query.upgrade.status,d,e),e=VyprUrlHelper.addUpdateParam(c.constants.query.upgrade.type,a,e),window.location=e},1e3*this.g_get_upgrade_refresh_delay)},Vypr.prototype.doServerScript=function(){var a="server";VyprVPNInit.loadScript("/user/vyprvpn/js/core/"+a+".js"),this.g_loaded_scripts.push(a)},Vypr.prototype.doRequest=function(a,b,c,d,e,f){var g=Array.prototype.slice.call(arguments),h=this.g_cgi_port?":"+this.g_cgi_port:"",i=VyprUrlHelper.getWindowLocationOrigin(window.location)+h;return g.unshift(i+"/user/cgi-bin/vyprvpn.cgi"),g[1]=JSON.stringify(g[1]),this.doXmlHttp.apply(this,g)},Vypr.prototype.doFile=function(a,b,c,d,e,f){var g=Array.prototype.slice.call(arguments),h=(new Date).getTime();return this.doXmlHttp(g[0],"t="+h,g[1],g[2],g[3],g[4],g[5])},Vypr.prototype.doXmlHttp=function(a,b,c,d,e,f,g){g=void 0!==g?g:this.g_timeout_limit;var h=this,i=new VyprXmlHttp,j=g*this.g_timeout,k=!1,l=b.search("VYPRVPN_FEEDBACK")!==-1?"post":"get",m=this.getCache("username"),n=this.getCache("password");return"get"===l&&k&&(b="json="+b),i.xob.hasOwnProperty("timeout")&&(i.xob.timeout=1e3*this.g_timeout),i.xob.ontimeout=function(){var a=h.g_timeout_count++;log.warn("Timeout for `doXmlHttp()`. Timeout is `"+h.g_timeout+"` seconds."),log.status("Request timeout failure `"+h.g_timeout_count+"` of `"+g+"`."),h.g_timeout_count>=g&&(h.g_timeout_count=0,"function"==typeof f&&(log.error("Too many timeouts for this request ("+j+" seconds)."),f.apply(h,[a]))),h.g_timeout_count>=h.g_timeout_limit&&(h.g_timeout_count=0,"function"==typeof d?d.apply(h,[a]):"function"==typeof f&&f.apply(h,[a]))},i.onCompleted=function(a,b){h.g_timeout_count=0,"function"==typeof c&&c.apply(h,[a,b])},i.onError=function(a){"function"==typeof d&&d.apply(h,[a])},!l in i?(log.error("Method `"+l+"` does not exist."),!1):(k?(log.status("Sending request with authentication."),i[l](a,b,m,n)):(log.status("Sending request without authentication."),i[l](a,b)),!0)},Vypr.prototype.requestGetUpgradeStatus=function(){var a=this,b=this.g_upgrading_type,c=!1,d=!1,e='{"res":"OK","data":{"status":"","progress":""}}',f=function(){log.error("Aborting upgrade after `"+a.g_timeout_limit+"` timeouts."),a.abortUpgrade(b)};if(!this.isKnownUpgrade(b))return log.error("Will not request upgrade status of type `"+b+"`."),!1;switch(b){case"app":c=this.doFile("/user/vyprvpn_app_status.html",this.handleGetUpgradeStatusResponse,function(a){log.warn("Error in requestGetUpgradeStatus()",a)},d,f)}c?log.status("Requesting upgrade status..."):(log.warn("Failed to request upgrade status of type `"+b+"`."),log.status("Passing empty upgrade status..."),this.handleGetUpgradeStatusResponse(e))},Vypr.prototype.requestCGIVariables=function(a,b){var c,d=this,e=!1;c=this.doFile("/var/vyprvpn/vyprvpn_cgi_variables.html",function(b,c){var e=d.parseResponse(b);log.success("Got CGI variables."),log.info(e),a(e)},function(a){log.warn("Error in requestCGIVariables()",a),b()},e),c?log.status("Requesting CGI variables..."):(log.warn("Failed to request CGI variables."),b())},Vypr.prototype.requestTemplate=function(a,b,c){var d,e=this,f=!0,g=a.search("//")>-1,h=g?a:"/user/vyprvpn/tpl/"+a;return this.g_loaded_templates.indexOf(a)>-1?(log.status("Abort request for `"+a+"` templates. Previously loaded."),void("function"==typeof c&&c())):(d=this.doFile(h,function(d,f){var g=e.handleTemplate(d,b,c);g?(this.g_loaded_templates.push(a),log.status("Succesfully loaded templates `"+a+"`.")):log.warn("Failed loading templates `"+a+"`.")},function(a){log.error("Error in requestTemplate(): ",a)},f),void(d?(log.status("Requesting `"+a+"` templates..."),this.g_loaded_templates.push(a)):log.error("Failed to request `"+a+"` templates.")))},Vypr.prototype.handleGetUpgradeStatusResponse=function(a){if(!a)return log.warn("Empty upgrade status response."),!1;var b=this.parseResponse(a),c=this.g_upgrading_type;if(!this.isKnownUpgrade(c))return log.error("Will not handle upgrade status of type `"+c+"`."),!1;if("FAIL"==b.res)return this.handleFailResponse(a),b;switch(log.success("Got upgrade status."),c){case"app":this.handleAppUpgradeStatus(b.data.status)}return b},Vypr.prototype.handleFailResponse=function(a){var b=this.parseResponse(a),c=3;if(!VYPR_CONSTANT.FAIL_QUIET||this.g_current_failure!==b.reason){if(this.g_current_failure=b.reason,"FAIL"==b.res)switch(VYPR_CONSTANT.FAIL_UI_DISABLE&&this.enableFields(!1),b.reason){case"ERR_SERVICE_OFFLINE":this.g_offline_count++,log.error("CGI error: "+b.reason),this.g_offline_count>c&&(this.setVyprWarning(this.constants.message.general.warning.offline),VyprVPN.startAppUpgradeStatusCheck());break;case"ERR_BAD_PROXY":log.error("CGI error: "+b.reason),this.setVyprError(this.constants.message.general.error.no_comm);break;case"ERR_TIMEOUT":log.warn("CGI error: "+b.reason);break;case"INVALID_STATE":case"INVALID_REQUEST":log.error("Daemon error: "+b.reason),this.setVyprError(this.constants.message.general.error.unknown);break;default:log.warn("Unknown error: "+b.reason),this.setVyprWarning(this.constants.message.general.error.unknown)}return b}},Vypr.prototype.handleAppUpgradeFailure=function(){log.error("Application upgrade failed."),this.g_upgrading_active=!1,this.doUpgradeRefresh("app",!1)},Vypr.prototype.handleAppUpgradeSuccess=function(){log.success("Application upgrade complete."),this.doUpgradeRefresh("app",!0)},Vypr.prototype.handleAppUpgradeStatus=function(a){var b=-1,c=this.getCache("app_upgrade_info_version"),d=!1,e=this.g_upgrading_template;switch(log.status("Received upgrade status of `"+a+"`."),a!==this.g_upgrading_previous_status&&(this.g_upgrading_status_time_elapsed=0,this.g_upgrading_previous_status=a),a){case this.constants.upgrade.requesting:this.setGetUpgradeStatusDelay(1),e="vypr--status-updating-requesting",this.g_upgrading_active=!0;break;case this.constants.upgrade.downloading:this.setGetUpgradeStatusDelay(.5),e="vypr--status-updating-downloading",this.g_upgrading_active=!0;break;case this.constants.upgrade.restarting:this.setGetUpgradeStatusDelay(1),e="vypr--status-updating-restarting",this.g_upgrading_active=!0;break;case this.constants.upgrade.no_internet:this.setVyprError(this.constants.message.upgrade.error.no_internet),this.abortUpgrade();break;case this.constants.upgrade.failed:return this.handleAppUpgradeFailure(),void this.setGetUpgradeStatusDelay(0);case this.constants.upgrade.not_upgrading:return this.g_upgrading_active===!0?this.handleAppUpgradeSuccess():(this.setGetUpgradeStatusDelay(1),e="vypr--status-updating-requesting",this.handleEndlessUpgradeStatus()),void(this.g_upgrading_active=!1);case"":case null:case void 0:this.g_upgrading_active===!0?(this.setGetUpgradeStatusDelay(2),b=this.g_upgrading_progress):(this.setGetUpgradeStatusDelay(1),e="vypr--status-updating-requesting",this.handleEndlessUpgradeStatus());break;default:this.setVyprError(this.constants.message.upgrade.error.unknown),this.abortUpgrade()}e!==this.g_upgrading_template&&(this.showUpgradeTemplate.apply(this,[e]),this.g_upgrading_template=e,this.g_upgrading_progress=b),d=this.populateStatus(b,c),d||this.stopGetStatus()},Vypr.prototype.handleEndlessUpgradeStatus=function(){this.g_upgrading_status_time_elapsed>this.g_upgrading_status_time_limit&&(log.warn("Excessive wait requesting upgrade."),this.setVyprWarning(this.constants.message.upgrade.warning.excessive_wait,document.getElementById("waiting")),this.abortUpgrade())},Vypr.prototype.handleTemplate=function(a,b,c){var d=new DOMParser,e=d.parseFromString(a,"text/html"),f=null;return e?(f=document.createDocumentFragment(),temporaryEl=f.appendChild(document.createElement("div")),b?(log.success("Templates received."),temporaryEl=e.body.firstChild,this.bindTemplateAppend(temporaryEl,b),VyprElementHelper.removeWhitespace(b),"function"==typeof c&&c(),!0):(log.warn("Not binding templates. Unable to find bind location."),!1)):void log.error("Templates file is empty.")},Vypr.prototype.startGetStatus=function(a){function b(){this.requestGetStatus(),this.g_get_status_count++}var c=this.isVyprFramePage(),d=this.isVyprContentPage(),e=c?"frame":d?"content":"",f={isFromMessage:!0};this.g_get_status_interval||(b.apply(this),this.g_get_status_interval=window.setInterval(b.bind(this),1e3*this.g_get_status_delay),log.status('Started "get status" for the window `'+e+"`.")),a||(c?this.messageSendToContentPage("vypr.poll.get.status.start",f):d&&this.messageSendToFramePage("vypr.poll.get.status.start",f))},Vypr.prototype.stopGetStatus=function(a){var b=this.isVyprFramePage(),c=this.isVyprContentPage(),d=b?"frame":c?"content":"",e={isFromMessage:!0};this.g_get_status_interval&&(this.g_get_status_interval=window.clearInterval(this.g_get_status_interval),log.status('Stopped "get status" for the window `'+d+"`.")),a||(b?this.messageSendToContentPage("vypr.poll.get.status.stop",e):c&&this.messageSendToFramePage("vypr.poll.get.status.stop",e))},Vypr.prototype.startAppUpgradeStatusCheck=function(){var a,b=!0;log.status("Checking for application upgrade status..."),this.stopGetStatus(),a=this.doFile("/user/vyprvpn_app_status.html",this.handleAppUpgradeStatusCheck,function(a){log.error("Error in startAppUpgradeStatusCheck().",a)},b),a?log.status("Requesting application upgrade status..."):log.error("Failed to check application upgrade status.")},Vypr.prototype.handleAppUpgradeStatusCheck=function(a){this.handleUpgradeStatusCheck("app",a)},Vypr.prototype.handleUpgradeStatusCheck=function(a,b){var c="app"===a?1e3*this.g_get_status_delay:0,d=b?this.parseResponse(b):void 0;if(!b){switch(log.warn("Upgrade status not found."),a){case"app":log.status("Trying again in "+this.g_get_status_delay+" seconds."),window.setTimeout(this.startAppUpgradeStatusCheck.bind(this),c)}return!1}switch(d.data.status){case this.constants.upgrade.no_internet:log.status("Check complete. No internet available."),this.g_upgrading?this.handleAppUpgradeStatus(this.constants.upgrade.no_internet):this.setVyprWarning(this.constants.message.upgrade.error.no_internet),window.setTimeout(this.startGetStatus.bind(this),c);break;case this.constants.upgrade.not_upgrading:log.status("Check complete. No upgrade in progress."),window.setTimeout(this.startGetStatus.bind(this),c);break;case this.constants.upgrade.failed:log.status("Check complete. Upgrade failed."),this.setVyprError(this.constants.message.upgrade.error[a]);break;case"":case null:case void 0:log.status("Check complete. No status received."),window.setTimeout(this.startGetStatus.bind(this),c);break;default:log.status("Check complete. Upgrade in progress."),this.startUpgrade(a)}},Vypr.prototype.startGetUpgradeStatus=function(){var a=this,b=function(){a.g_upgrading_status_time_elapsed++,a.requestGetUpgradeStatus()};void 0===this.g_get_upgrade_status_interval&&window.setTimeout(function(){b.apply(a),a.g_get_upgrade_status_interval=window.setInterval(function(){b.apply(a)},1e3*a.g_get_upgrade_status_delay)},1e3*this.g_get_upgrade_status_delay_initial)},Vypr.prototype.stopGetUpgradeStatus=function(){void 0!==this.g_get_upgrade_status_interval&&(this.g_get_upgrade_status_interval=window.clearInterval(this.g_get_upgrade_status_interval),this.g_get_upgrade_status_interval=void 0)},Vypr.prototype.setGetUpgradeStatusDelay=function(a){return a===this.g_get_upgrade_status_delay?(log.status("Maintaining frequency of upgrade status check. `"+a+"` seconds."),!1):(a>this.g_get_upgrade_status_delay?log.status("Decreased frequency of upgrade status check. `"+a+"` seconds."):log.status("Increased frequency of upgrade status check. `"+a+"` seconds."),this.stopGetUpgradeStatus(),this.g_get_upgrade_status_delay=a,this.startGetUpgradeStatus(),void 0)},Vypr.prototype.startUpgrade=function(a,b){var c=(window.location.href,this.g_upgrading===!0,this.isKnownUpgrade(a)),d=!1;if(log.status("Upgrade requested."),!c)return log.error("Will not start unknown update `"+a+"`."),!1;switch(this.stopGetStatus(),this.clearMessages(),this.setViewUpdateStatus(),this.g_upgrading_type=a,this.startGetUpgradeStatus(),a){case"app":this.handleAppUpgradeStatus.apply(this,b||[])}return d=this.setViewAppStatus(this.constants.view.updating),d&&this.messageSendToFramePage("vypr.dom.reset.iframe.dimensions",{options:{shouldResetBeforeCalculation:!0}}),this.g_upgrading=!0,!0},Vypr.prototype.stopUpgrade=function(a){return this.stopGetUpgradeStatus(),this.startGetStatus(),this.setViewAppStatus(this.constants.view.updating),this.enableFields(!0),this.g_upgrading=!1,this.g_upgrading_type="",this.g_upgrading_progress=void 0,this.g_upgrading_status_time_elapsed=0,!0},Vypr.prototype.abortUpgrade=function(a){var b=VyprUrlHelper.getWindowLocationOrigin(window.location)+window.location.pathname;return!!window.confirm(this.constants.message.upgrade.error.timeout)&&(this.stopGetUpgradeStatus(),window.location=b,!0)},Vypr.prototype.isKnownUpgrade=function(a){var b,c,d=this.constants.upgradeTypes,e=!1;for(b=0,c=d.length;b<c;++b)if(e=d[b]===a)return!0;return!1},Vypr.prototype.showUpgradeTemplate=function(a){var b=!0;log.status("Upgrade state change. Loading template `"+a+"`."),this.bindTemplateReplace(document.getElementById(a),document.getElementById("waiting"),b),window.scrollTo(0,0)},Vypr.prototype.setCache=function(a,b){localStorage.getItem(a);return void 0==b?b:(localStorage.setItem(a,JSON.stringify(b)),log.cache(a,b),b)},Vypr.prototype.getCache=function(a){var b=localStorage.getItem(a);return JSON.parse(b)},Vypr.prototype.getToggleMap=function(){return this.getCache("toggle_map")||{}},Vypr.prototype.setToggleMap=function(a){this.setCache("toggle_map",a)},Vypr.prototype.bindTemplatePrepend=function(a,b,c){if(!a||!b)return log.warn("Unable to `bindTemplatePrepend`.",arguments),a;if(!b.hasChildNodes())return this.bindTemplateAppend(a,b,c);if(!c)return b.insertBefore(a,b.firstChild);var d=document.createDocumentFragment(),e=a.cloneNode(!0);return d.appendChild(e),b.insertBefore(d,b.firstChild)},Vypr.prototype.bindTemplateAppend=function(a,b,c){if(!a||!b)return log.warn("Unable to `bindTemplateAppend`.",arguments),a;if(!c)return b.appendChild(a);var d=document.createDocumentFragment(),e=a.cloneNode(!0);return d.appendChild(e),b.appendChild(d)},Vypr.prototype.bindTemplateReplace=function(a,b,c,d){if(!a||!b)return log.warn("Unable to `bindTemplateReplace`.",arguments),a;if(d===!0)return b.innerHTML=a.innerHTML,c||a.parentNode.removeChild(a),b;var e=document.createDocumentFragment(),f=a.cloneNode(!0);return c||a.parentNode.removeChild(a),b.innerHTML="",e.appendChild(f),b.appendChild(e)},Vypr.prototype.setViewAppStatus=function(a){if(this.g_current_view===a)return log.status("View has not changed."),!1;if(a<this.constants.view.lowest||a>this.constants.view.highest)return!1;var b="data-vypr-visible-if-status";switch(this.g_current_view=a,a){case this.constants.view.login:log.success("Set view app status to Login."),this.setElementVisibilityByData(b,["online","not-logged"]);break;case this.constants.view.not_connected:log.success("Set view app status to Not Connected."),this.setElementVisibilityByData(b,["online","logged","not-connected"]);break;case this.constants.view.fail_connected:log.success("Set view app status to Fail Connected."),this.setElementVisibilityByData(b,["online","logged","not-connected"]);break;case this.constants.view.connected:log.success("Set view app status to Connected."),this.setElementVisibilityByData(b,["online","logged","connected"]);break;case this.constants.view.connecting:log.success("Set view app status to Connecting."),this.setElementVisibilityByData(b,["online","logged","connecting"]);break;case this.constants.view.disconnecting:log.success("Set view app status to Disconnecting."),this.setElementVisibilityByData(b,["online","logged","disconnecting"]);break;case this.constants.view.updating:log.success("Set view app status to Updating."),this.setElementVisibilityByData(b,["updating"])}return!0},Vypr.prototype.setViewUpdateStatus=function(a,b){var c=b?a:["none"];log.success("Set view update state to: "+c.toString()),this.setElementVisibilityByData("data-vypr-visible-if-update",c)},Vypr.prototype.setViewPageType=function(a){var b=a||[];log.success("Set view page type to: "+b.toString()),this.setElementVisibilityByData("data-vypr-visible-if-page",b)},Vypr.prototype.setElementVisibilityByData=function(a,b){function c(a,c){for(var d=a.querySelectorAll("["+c+"]"),e=0;e<d.length;++e){var f=d[e];b.some(function(a){var b=f.getAttribute(c).split(" "),d=b.indexOf(a)>-1;return d?(f.removeAttribute("hidden"),!0):void f.setAttribute("hidden","hidden")})}a.body.setAttribute(c+"-values",b.join(" "))}c(window.document,a),this.isVyprFramePage()?(windowRef=this.getVyprContentPage(),windowRef&&c(windowRef.document,a)):this.isVyprContentPage()&&(windowRef=this.getVyprFramePage(),windowRef&&c(windowRef.document,a))},Vypr.prototype.addMessage=function(a,b,c,d){c="GET_DOCUMENT"===c?document:c;var e=VyprElementHelper.isNodeOfCurrentDocument(c),f={message:a,type:b,id:d,contextEl:e?c:"GET_DOCUMENT"};if(!e){var g=this.isVyprStyle(),h=Boolean(this.getVyprFramePage());if(this.isVyprFramePage()&&!g)return void this.messageSendToContentPage("vypr.dom.add.message",f);if(this.isVyprContentPage()&&g&&h)return void this.messageSendToFramePage("vypr.dom.add.message",f)}var i=c.querySelectorAll('[data-vypr-role="messagewrap"]'),j=i.length>0,k=Boolean(a&&b);
if(!k)return void log.warn("Message not added (invalid message):",f);for(var l=0;l<i.length;++l){var m=i[l],n=m.querySelector('[data-vypr-role~="template"]'),o=n.cloneNode(!0),p=o.querySelector('[data-vypr-role="message-text"]'),q=o.querySelector('[data-vypr-action="message-close"]');p&&VyprElementHelper.setTextContent(p,a),d&&o.setAttribute("data-vypr-id",d),VyprElementHelper.addClass(o,this.constants.className[b]),o.setAttribute("data-vypr-role","message"),q&&this.handleMessageCloseTrigger(q),m.appendChild(o)}j?log.info("Message added:",f):log.warn("Message not added (unable to find container):",f)},Vypr.prototype.addMessageSuccess=function(a,b,c){this.addMessage(a,"success",b,c)},Vypr.prototype.addMessageNotice=function(a,b,c){this.addMessage(a,"notice",b,c)},Vypr.prototype.addMessageError=function(a,b,c){this.addMessage(a,"error",b,c)},Vypr.prototype.addMessageWarning=function(a,b,c){this.addMessage(a,"warning",b,c)},Vypr.prototype.removeMessage=function(a,b){b="GET_DOCUMENT"===b?document:b;var c=VyprElementHelper.isNodeOfCurrentDocument(b),d=document.querySelector('[data-vypr-id="'+a+'"]'),e={id:a,contextEl:c?b:"GET_DOCUMENT"};if(!c){var f=this.isVyprStyle(),g=Boolean(this.getVyprFramePage());if(this.isVyprFramePage()&&!f)return void this.messageSendToContentPage("vypr.dom.remove.message",e);if(this.isVyprContentPage()&&f&&g)return void this.messageSendToFramePage("vypr.dom.remove.message",e)}d?(d.parentNode.removeChild(d),log.info("Message removed:",e)):log.warn("Message not removed (unable to find message):",e)},Vypr.prototype.clearMessages=function(a){a="GET_DOCUMENT"===a?document:a;var b=VyprElementHelper.isNodeOfCurrentDocument(a),c={contextEl:b?a:"GET_DOCUMENT"};if(!b){var d=this.isVyprStyle(),e=Boolean(this.getVyprFramePage());if(this.isVyprFramePage()&&!d)return void this.messageSendToContentPage("vypr.dom.clear.messages",c);if(this.isVyprContentPage()&&d&&e)return void this.messageSendToFramePage("vypr.dom.clear.messages",c)}for(var f=a.querySelectorAll('[data-vypr-role="messagewrap"]'),g=f.length>0,h=0;h<f.length;++h)for(var i=f[h],j=i.querySelectorAll('[data-vypr-role="message"]'),k=0;k<j.length;++k){var l=j[k];l&&l.parentNode.removeChild(l)}g?log.info("Messages cleared:",c):log.warn("Messages not cleared (unable to find container):",c)},Vypr.prototype.setVyprSuccess=function(a,b,c){this.clearMessages(b),this.addMessage(a,"success",b,c)},Vypr.prototype.setVyprNotice=function(a,b,c){this.clearMessages(b),this.addMessage(a,"notice",b,c)},Vypr.prototype.setVyprError=function(a,b,c){this.clearMessages(b),this.addMessage(a,"error",b,c)},Vypr.prototype.setVyprWarning=function(a,b,c){this.clearMessages(b),this.addMessage(a,"warning",b,c)},Vypr.prototype.populateCommonLayout=function(a){var b=document.getElementById("templates");this.bindTemplatePrepend(document.getElementById("waiting"),document.getElementById("content")),this.requestTemplate("upgrades.html",b,function(){"function"==typeof a&&a()})},Vypr.prototype.populateStatus=function(a,b){var c=VyprElementHelper.getElementById("waiting",this.g_upgrading_template)||VyprElementHelper.getElementById("content",this.g_upgrading_template);if(!c||!c.nodeType)return log.warn("Cannot populate status. Template `"+this.g_upgrading_template+"` not found"),!1;var d={versionText:VyprElementHelper.getElementsByClassName(c,"vypr--status-updating-version"),progressWrap:VyprElementHelper.getElementsByClassName(c,"vypr--progressdisplay"),progressBar:VyprElementHelper.getElementsByClassName(c,"vypr--progressdisplay-itemwrap"),progressValue:VyprElementHelper.getElementsByClassName(c,"vypr--progressdisplay-item-value")},e={active:"active",pending:"unknown",none:"null",prefix:this.constants.className.statusPrefix},f=function(a,b){b=parseInt(b,10);var c=b>0?b:0,d=c.toString()+"%";a.style.width=d},g=""!==a&&null!==a&&void 0!==a;return b&&d.versionText.length&&VyprElementHelper.setTextContent(d.versionText[0],b),g&&d.progressValue.length&&VyprElementHelper.setTextContent(d.progressValue[0],a),VyprElementHelper.removeClasses(d.progressWrap[0],[e.active,e.pending,e.none],e.prefix),g?a>=0?(f(d.progressBar[0],a),VyprElementHelper.addClasses(d.progressWrap[0],[e.active],e.prefix)):VyprElementHelper.addClasses(d.progressWrap[0],[e.pending],e.prefix):VyprElementHelper.addClasses(d.progressWrap[0],[e.none],e.prefix),!0},Vypr.prototype.updateScrollpane=function(){var a,b,c=VyprElementHelper.getElementsByClassName(document.getElementById("content"),"scrollpane"),d=document.getElementById("content"),e=parseInt(VyprElementHelper.css(d,"padding-top").replace("px",""),10),f=parseInt(VyprElementHelper.css(d,"padding-bottom").replace("px",""),10),g=e+f,h=window.getViewportHeight(),i=window.getViewportScrollTop(),j=window.getPageHeight(),k=j<=h+i;for(a=0,b=c.length;a<b;a++){var l=c[a],m=VyprElementHelper.getPageOffset(l).top,n=1;k||(l.style.maxHeight=(h-m+i-n-g).toString()+"px")}},Vypr.prototype.updateIframe=function(a){window.vyprStretchIframe(document.getElementById("vypr--iframe"),a)},Vypr.prototype.setInvalidClass=function(a,b){a._vypr_error_message=b,a._vypr_title_original=a.title,b&&(a.title=b),VyprElementHelper.addClass(a,this.constants.className.invalid)},Vypr.prototype.clearInvalidClass=function(a){a._error_org&&(a.title=a._error_org),VyprElementHelper.removeClass(a,this.constants.className.invalid),a._vypr_error_message=null,a._vypr_title_original=null},Vypr.prototype.handleVisibilityToggles=function(){for(var a=document.querySelectorAll("[data-vypr-toggle-for]"),b=this.getToggleMap(),c=0;c<a.length;++c){var d=a[c],e=d.getAttribute("data-vypr-toggle-for"),f=d.getAttribute("data-vypr-toggle-type"),g=d.getAttribute("data-vypr-toggle-autofocus"),h=b[e],i=null!=h,j=i?h:null!==g,k=document.getElementById(e);k&&this.handleVisibilityToggle(d,k,f,j)}this.setToggleMap(b)},Vypr.prototype.handleVisibilityToggle=function(a,b,c,d){var e,f,g,h=this,i=document.getElementsByTagName("body")[0],j=function(a){var b=a.hasAttribute("hidden");return!b},k=function(a,b){var c=a.getAttribute("data-vypr-toggle-for"),d=h.getToggleMap();a.setAttribute("open",""),b.removeAttribute("hidden"),d[c]=!0,h.setToggleMap(d)},l=function(a,b){var c=a.getAttribute("data-vypr-toggle-for"),d=h.getToggleMap();a.removeAttribute("open"),b.setAttribute("hidden","hidden"),d[c]=!1,h.setToggleMap(d)},m={};if(!a&&!b)return log.error("Could not handleVisibilityToggle because elTrigger and elTarget do not exist"),log.info({elTrigger:a,elTarget:b}),!1;if(a.setAttribute("data-vypr-toggle-on",""),"tab"===c){var n=document.getElementById(a.getAttribute("for"));n.setAttribute("hidden","hidden")}a.addEventListener("click",function(d){switch(evt.stopPropagation(d),c){case"tab":for(m.triggers=document.querySelectorAll('[data-vypr-toggle-type="tab"]'),f=0,g=m.triggers.length;f<g;++f)m.trigger=m.triggers[f],e=m.trigger.getAttribute("data-vypr-toggle-for"),e!==b.id?(m.tab=document.getElementById(e),l(m.trigger,m.tab)):k(a,b);break;default:j(b)?l(a,b):k(a,b)}h.updateScrollpane()},!1),d?k(a,b):l(a,b),"menu"===c&&i.addEventListener("click",function(c){l(a,b)},!1)},Vypr.prototype.handleMessageCloseTrigger=function(a){return a?(a.addEventListener("click",function(a){var b=VyprElementHelper.querySelectorClosest(this,'[data-vypr-role="message"]');b&&b.parentNode.removeChild(b)},!1),!0):(log.warn("Message close trigger not found.",a),!1)},Vypr.prototype.handleMessageCloseTriggers=function(a){a=a?a:document;for(var b=a.querySelectorAll('[data-vypr-action="message-close"]'),c=0;c<b.length;++c){var d=b[c];this.handleMessageCloseTrigger(d)}},Vypr.prototype.handleUrlQuery=function(){var a=VyprUrlHelper.getParams(),b=a[this.constants.query.upgrade.type]||"any",c=a[this.constants.query.upgrade.status];switch(c){case this.constants.upgrade.complete:this.setVyprSuccess(this.constants.message.upgrade.success[b]);break;case this.constants.upgrade.failed:this.setVyprError(this.constants.message.upgrade.error[b])}},window.getViewportHeight=function(){var a=0,b=window.document.body;return window.innerHeight?a=window.innerHeight:b.parentElement.clientHeight?a=b.parentElement.clientHeight:b&&b.clientHeight&&(a=b.clientHeight),a},window.getViewportScrollTop=function(){return window.pageYOffset},window.getPageHeight=function(){return Math.max(document.documentElement.clientHeight,document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight)},window.getScrollBarWidth=function(){var a=document.createElement("div");a.style.visibility="hidden",a.style.width="100px",a.style.msOverflowStyle="scrollbar",document.body.appendChild(a);var b=a.offsetWidth;a.style.overflow="scroll";var c=document.createElement("div");c.style.width="100%",a.appendChild(c);var d=c.offsetWidth;return a.parentNode.removeChild(a),b-d},Vypr.prototype.prep=function(){var a=this;return this.iniDebug(),this.isFrameContentPage()&&VyprElementHelper.addClass(document.body,"has-iframe"),this.isVyprContentPage()?(VyprElementHelper.removeWhitespace("content"),manipulateAddTemplateDiv(),void this.populateCommonLayout(function(){a.handleUrlQuery(),a.g_upgrading===!1&&a.doServerScript()})):void this.doServerScript()},Vypr.prototype.iniDebug=function(){var a=document.getElementsByTagName("body")[0],b=VyprUrlHelper.getParams();b.debug&&VyprElementHelper.addClass(a,this.constants.className.debug)},VyprVPN=new Vypr,VyprVPN.prep();