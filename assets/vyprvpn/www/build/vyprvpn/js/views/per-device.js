function VyprBinding(){this.constants.config={vpn_default:0,vpn_skip:1,vpn_only:2,vpn_preferred:3},this.constants.idPrefixes={name:"vypr--device-name-",nameLabel:"vypr--device-name-label-",nameSave:"vypr--device-name-saved-",addressMac:"vypr--device-address-mac-",addressIp:"vypr--device-address-ip-",config:"vypr--device-config-",configDefName:"vypr--device-config-default",configDefOption:"vypr--device-config-default-opt-"},this.cache.updateUi.device_name=this.updateDeviceName,this.cache.updateUi.device_config=this.updateDeviceConfig,this.cache.updateUi.default_config=this.updateDefaultConfig,this.g_devices=null,this.g_enable_fields_ids.push(this.constants.idPrefixes.configDefOption+"1"),this.g_enable_fields_ids.push(this.constants.idPrefixes.configDefOption+"2"),this.g_enable_fields_ids.push(this.constants.idPrefixes.configDefOption+"3")}Object.prototype.hasOwnValue=function(a){for(var b in this)if(this.hasOwnProperty(b)&&this[b]===a)return!0;return!1},VyprBinding.prototype=new Vypr,VyprBinding.prototype.requestSetDevice=function(a,b,c,d){var e,f=this,g=!0;this.setDeviceStatus(a,"progress"),e=this.doRequest(["VYPRVPN_BIND_DEVICES",[b,c,d]],function(){var b=f.handleSetDeviceResponse.apply(f,arguments);b?f.setDeviceStatus(a,"success"):(f.setDeviceStatus(a,"warning"),f.updateFromCache("device_name",void 0,a),f.updateFromCache("device_config",void 0,a)),f.enableFields(!0)},function(b){log.error("Error in requestSetDevice(): ",b),f.setDeviceStatus(a,"warning"),f.updateFromCache("device_name",void 0,a),f.updateFromCache("device_config",void 0,a),f.enableFields(!0)},g,function(b){log.warn("Timeout in requestSetDevice(). Gave up after "+b+" attempts."),f.setDeviceStatus(a,"warning"),f.enableFields(!0)}),e&&(log.status("Saving device..."),this.enableFields(!1))},VyprBinding.prototype.requestSetDefault=function(a,b){var c=this,d=!0;this.setDeviceStatus(a,"progress"),request_issued=this.doRequest(["VYPRVPN_BIND_DEFAULT",b],function(){var d=c.handleSetDefaultResponse.apply(c,arguments);d?(c.setDeviceStatus(a,"success"),c.setCache("default_config",b)):(c.setDeviceStatus(a,"warning"),c.updateFromCache("default_config")),c.enableFields(!0)},function(b){log.error("Error in requestSetDefault(): ",b),c.setDeviceStatus(a,"warning"),c.updateFromCache("default_config"),c.enableFields(!0)},d,function(b){log.warn("Timeout in requestSetDevice(). Gave up after "+b+" attempts."),c.setDeviceStatus(a,"warning"),c.enableFields(!0)}),request_issued&&(log.status("Saving device default configuration..."),this.enableFields(!1))},VyprBinding.prototype.requestGetDevices=function(){this.doRequest(["VYPRVPN_BIND_GET_DEVICES"],this.handleGetDevicesResponse,function(a){log.error("Error in requestGetDevices(): ",a)})},VyprBinding.prototype.handleStatus=function(a){switch(Vypr.prototype.handleStatus.apply(this,arguments),a){case"NOT_LOGGED_IN":case"LOGIN_FAILED":case"LOGGED_IN":case"CONNECTED":case"CONNECTING":case"CONNECT_FAILED":case"DISCONNECTING":null!==this.g_devices||this.isGettingDevices?this.enableFields(!0):(this.isGettingDevices=!0,log.status("Retrieving device list..."),this.enableFields(!1),this.requestGetDevices())}},VyprBinding.prototype.handleSetDeviceResponse=function(a){var b=this.parseResponse(a);return"FAIL"==b.res?(this.handleFailResponse(a),!1):(log.success("Set device."),!0)},VyprBinding.prototype.handleSetDefaultResponse=function(a){var b=this.parseResponse(a);return"FAIL"==b.res?(this.handleFailResponse(a),!1):(log.success("Set default config."),!0)},VyprBinding.prototype.handleGetDevicesResponse=function(a){var b=this.parseResponse(a),c=this.getCache("default_config");return"FAIL"==b.res?void this.handleFailResponse(a):(log.success("Got devices."),this.enableFields(!0),this.g_devices=b.data,this.populateDevices(),this.populateDefaultConfig(c),this.setEnableFields(),this.handleTableSort("vypr-table-connected"),this.handleTableSort("vypr-table-disconnected"),void 0)},VyprBinding.prototype.populateDevices=function(){var a=this.g_devices,b={itemConnected:document.getElementById("vypr-table-connected-item-tpl"),itemDisconnected:document.getElementById("vypr-table-disconnected-item-tpl"),id:"X"},c={containerConnected:document.getElementById("vypr-table-connected-item-container"),containerDisonnected:document.getElementById("vypr-table-disconnected-item-container"),itemsConnected:[],itemsDisconnected:[],item:null,name:null,nameLabel:null,nameSave:null,addressMac:null,addressIp:null,config:null},d="",e=null,f="",g=0;for(key in a)c.item=null,a.hasOwnProperty(key)&&(f=g.toString(),d=key,device=a[d],e=!device.lastseen,e===!0?c.item=b.itemConnected.cloneNode(!0):c.item=b.itemDisconnected.cloneNode(!0),c.name=VyprElementHelper.getElementById(c.item,this.constants.idPrefixes.name+b.id),c.nameLabel=VyprElementHelper.getElementById(c.item,this.constants.idPrefixes.nameLabel+b.id),c.nameSave=VyprElementHelper.getElementById(c.item,this.constants.idPrefixes.nameSave+b.id),c.addressMac=VyprElementHelper.getElementById(c.item,this.constants.idPrefixes.addressMac+b.id),c.addressIp=VyprElementHelper.getElementById(c.item,this.constants.idPrefixes.addressIp+b.id),c.config=VyprElementHelper.getElementById(c.item,this.constants.idPrefixes.config+b.id),c.name.id=this.constants.idPrefixes.name+f,c.nameLabel.id=this.constants.idPrefixes.nameLabel+f,c.nameSave.id=this.constants.idPrefixes.nameSave+f,c.addressMac.id=this.constants.idPrefixes.addressMac+f,c.addressIp.id=this.constants.idPrefixes.addressIp+f,c.config.id=this.constants.idPrefixes.config+f,c.name.setAttribute("name",this.constants.idPrefixes.name+f),c.nameLabel.setAttribute("for",this.constants.idPrefixes.name+f),c.name.value=device.name,VyprElementHelper.setTextContent(c.nameSave,device.name),VyprElementHelper.setTextContent(c.addressMac,d),VyprElementHelper.setTextContent(c.addressIp,device.ip),VyprElementHelper.setSelectedIndexByValue(c.config,device.choice),c.item.id=c.item.id.replace(this.constants.re.stringReplace,f),c.item.removeAttribute("hidden"),e===!0?c.itemsConnected.push(c.item):c.itemsDisconnected.push(c.item),g++);VyprElementHelper.appendChildArray(c.containerConnected,c.itemsConnected),VyprElementHelper.appendChildArray(c.containerDisonnected,c.itemsDisconnected),this.setEventHandlers()},VyprBinding.prototype.populateDeviceName=function(a,b){var c={input:document.getElementById(this.constants.idPrefixes.name+a),text:document.getElementById(this.constants.idPrefixes.nameSave+a)};c.input.value=b,VyprElementHelper.setTextContent(c.text,b)},VyprBinding.prototype.populateDeviceConfig=function(a,b){var c=document.getElementById(this.constants.idPrefixes.config+a);VyprElementHelper.setSelectedIndexByValue(c,b)},VyprBinding.prototype.populateDefaultConfig=function(a){var b=this.constants.idPrefixes.configDefName;VyprElementHelper.setCheckedRadioByValue(b,a)},VyprBinding.prototype.updateDeviceName=function(a){var b=this.getCache("device_name"+a);return void 0===b?void log.warn("No value for device name. Skipping udpate."):void this.populateDeviceName(a,b)},VyprBinding.prototype.updateDeviceConfig=function(a){var b=this.getCache("device_config"+a);return void 0===b?void log.warn("No value for device configuration. Skipping udpate."):void this.populateDeviceConfig(a,b)},VyprBinding.prototype.updateDefaultConfig=function(){var a=this.getCache("default_config");return void 0===a?void log.warn("No value for default configuration. Skipping udpate."):void this.populateDefaultConfig(a)},VyprBinding.prototype.getDevice=function(a){var b={defaultSetting:document.getElementById("vypr-table-default-item"),deviceConnected:document.getElementById("vypr-table-connected-item-"+a),deviceDisconnected:document.getElementById("vypr-table-disconnected-item-"+a)},c=null;if("default"===a)c=b.defaultSetting;else if(b.deviceConnected)c=b.deviceConnected;else{if(!b.deviceDisconnected)return void log.warn("Device `"+a+"` was not found in page.");c=b.deviceDisconnected}return c},VyprBinding.prototype.getDeviceId=function(a){return"string"!=typeof a?(log.warn("Cannot get device id. Parameter is not a string. Returning blank string"),""):a.replace(this.constants.re.NoNumberAttrSegmentFind,"")},VyprBinding.prototype.setDeviceStatus=function(a,b){var c=this.getDevice(a)||void 0;this.setElementStatus(c,b)},VyprBinding.prototype.setEnableFields=function(){for(var a=this.g_devices?Object.keys(this.g_devices).length:0,b=0;b<a;)this.g_enable_fields_ids.push(this.constants.idPrefixes.name+b),this.g_enable_fields_ids.push(this.constants.idPrefixes.config+b),this.g_enable_fields_ids.push(this.constants.idPrefixes.nameLabel+b),b++},VyprBinding.prototype.verifyFields=function(a){var b=this,c="",d=[],e=!1,f=this.g_devices?Object.keys(this.g_devices).length:0,g=0,h={name:function(a){var c=a.value.trim(),d=c.length>0,e=b.getDeviceId(a.id),f=document.getElementById(b.constants.idPrefixes.nameLabel+e);return d?(b.clearInvalidClass(a),b.clearInvalidClass(f),!0):(b.setInvalidClass(a,"Invalid device name."),b.setInvalidClass(f,"Invalid device name."),!1)},config:function(a){var c=parseInt(a.value,10),d=b.constants.config.hasOwnValue(c),e=d;return e?(b.clearInvalidClass(a),!0):(b.setInvalidClass(a,"Invalid device config."),!1)},configDef:function(a){var c=parseInt(a.value,10),d=b.constants.config.hasOwnValue(c),e=c!==b.constants.config.vpn_default,f=d&&e;return f?(b.clearInvalidClass(a),!0):(b.setInvalidClass(a,"Invalid device config."),!1)}};if(a){if(c=this.getDeviceId(a.id),isDeviceName=0===a.id.search(this.constants.idPrefixes.name),isDeviceConfig=0===a.id.search(this.constants.idPrefixes.config),isDefaultConfig=0===a.id.search(this.constants.idPrefixes.configDefName),isDeviceName)return e=h.name(a),e||this.setDeviceStatus(c,"warning"),e;if(isDeviceConfig)return e=h.config(a),e||this.setDeviceStatus(c,"warning"),e;if(isDefaultConfig)return e=h.configDef(a),e||this.setDeviceStatus("default","warning"),e}else{for(;g<f;)c=g.toString(),a=document.getElementById(this.constants.idPrefixes.name+c),h.name(a),a=document.getElementById(this.constants.idPrefixes.config+c),h.config(a),g++;d=document.getElementsByName(this.constants.idPrefixes.configDefName);for(var i=0,j=d.length;i<j;++i)a=d[i],a.getAttribute("checked")&&h.configDef(a)}return!0},VyprBinding.prototype.setEventHandlers=function(){var a=this,b="",c=function(){log.warn("No autoSave function defined."),log.warn(this)},d=function(){var b=this.getAttribute("for"),c=document.getElementById(b);return!c.getAttribute("disabled")&&(VyprElementHelper.addClass(this,a.constants.className.active),VyprElementHelper.addClass(c,a.constants.className.active),void c.focus())},e=function(){var b=this.id.replace(a.constants.re.NoNumberAttrSegmentFind,""),c=document.getElementById(a.constants.idPrefixes.nameLabel+b);VyprElementHelper.removeClass(this,a.constants.className.active),VyprElementHelper.removeClass(c,a.constants.className.active)},f=null,g=null,h=null,i=this.g_devices?Object.keys(this.g_devices).length:0,j=0,k=0===this.g_events_handled_count;if(k)Vypr.prototype.setEventHandlers.apply(this),this.handleDefaultConfig();else for(c=function(){var b=a.getDeviceId(this.id),c=document.getElementById(a.constants.idPrefixes.name+b),d=document.getElementById(a.constants.idPrefixes.nameSave+b),e=document.getElementById(a.constants.idPrefixes.addressMac+b),f=document.getElementById(a.constants.idPrefixes.config+b),g=c.value.trim(),h=VyprElementHelper.getTextContent(e),i=parseInt(f.value,10),j=a.getCache("device_name"+b),k=a.getCache("device_config"+b),l=a.verifyFields.apply(a,[c]),m=a.verifyFields.apply(a,[f]);return l?(void 0===j&&(j=g),m?(void 0===k&&(k=i),g===j&&i===k?(log.warn("No change made to device `"+b+"`. Aborting auto-save."),!1):(log.warn("Saving data on device `"+b+"`."),a.setCache("device_name"+b,g),a.setCache("device_config"+b,i),a.requestSetDevice.apply(a,[b,g,h,i]),void VyprElementHelper.setTextContent(d,g))):(log.warn("Using cached data for configuration of device `"+b+"`."),i=k,a.populateDeviceConfig(b,i),!1)):(log.warn("Using cached data for name of device `"+b+"`."),g=j,a.populateDeviceName(b,g),!1)},cacheSet=function(){var b,c,d=a.getDeviceId(this.id),e=this.id.search(a.constants.idPrefixes.name)>-1,f=this.id.search(a.constants.idPrefixes.config)>-1,g=a.verifyFields.apply(a,[this]);e?(c="device_name",b=this.value.trim()):f&&(c="device_config",b=parseInt(this.value,10)),g&&a.setCache(c+d,b)};j<i;)b=j.toString(),f=document.getElementById(a.constants.idPrefixes.name+b),g=document.getElementById(a.constants.idPrefixes.config+b),h=document.getElementById(a.constants.idPrefixes.nameLabel+b),f.addEventListener("blur",c,!1),f.addEventListener("blur",e,!1),f.addEventListener("focus",cacheSet,!1),g.addEventListener("change",c,!1),g.addEventListener("focus",cacheSet,!1),h.addEventListener("click",d,!1),j++;this.g_events_handled_count++},VyprBinding.prototype.handleDefaultConfig=function(){for(var a=this,b=document.getElementsByName(this.constants.idPrefixes.configDefName),c=0,d=b.length;c<d;++c){var e=b[c];e.addEventListener("change",function(){a.handleDefaultConfigAutoSave.apply(a,[this,parseInt(this.value,10)])},!1)}},VyprBinding.prototype.handleDefaultConfigAutoSave=function(a,b){var c=this.getCache("default_config"),d=this.verifyFields(a);this.getDeviceId(a.id);return d?b===c?void log.warn("No change made to default device configuration. Aborting auto-save."):void this.requestSetDefault("default",b):(log.warn("Invalid default device configuration requested. Using cached data instead."),this.populateDefaultConfig(c),void this.setDeviceStatus("default","warning"))},VyprBinding.prototype.handleTableSort=function(a){var b=document.getElementById(a);"undefined"!=typeof sorttable&&sorttable.makeSortable(b)},VyprBinding.prototype.init=function(){Vypr.prototype.init.apply(this,arguments)},VyprVPN=new VyprBinding,VyprVPN.init();