function VyprSettings(){this.constants.reconnect=[0,1,5,10,20],this.constants.analytics=[0,1],this.cache.updateUi.vyprvpn_reconnect=this.updateReconnect,this.cache.updateUi.vyprvpn_analytics=this.updateAnalytics,this.g_enable_fields_ids.push("vypr--logout-button"),this.g_enable_fields_ids.push("vypr--app-update-start"),this.g_enable_fields_ids.push("vypr--app-update-check"),this.g_enable_fields_ids.push("vypr-setting-analytics"),this.g_enable_fields_ids.push("vypr-setting-reconnect"),this.g_enable_fields_ids.push("vypr-setting-reconnect-limit")}toBoolean=function(a){return"string"==typeof a?"true"==a:Boolean(a)},Array.prototype.getClosest=function(a){var b,c=void 0;for(b=this.length;b--;)(void 0===c||Math.abs(this[b]-a)<Math.abs(c-a))&&(c=this[b]);return c},VyprSettings.prototype=new Vypr,VyprSettings.prototype.requestLogout=function(){var a=this.constants.message.authentication.confirmation.disconnect;if(this.g_current_view!==this.constants.view.connected||window.confirm(a)){var b,c=this;b=this.doRequest(["VYPRVPN_LOGOUT"],this.handleLogoutResponse,function(a){log.error("Error in requestLogout(): ",a),c.enableFields(!0)}),b&&(this.g_current_view===this.constants.view.connected?(log.status("Signing out... (assuming backend is disconnecting)"),this.setViewAppStatus(this.constants.view.disconnecting)):log.status("Signing out..."),this.enableFields(!1))}},VyprSettings.prototype.requestSetReconnect=function(a){var b,c=this,d=!0;this.setBlockStatus("reconnect","progress"),b=this.doRequest(["VYPRVPN_RECONNECT",a],function(){var a=c.handleSetReconnectResponse.apply(c,arguments);a?c.setBlockStatus("reconnect","success"):(c.setBlockStatus("reconnect","warning"),c.updateFromCache("vyprvpn_reconnect")),c.enableFields(!0)},function(a){log.error("Error in requestSetReconnect(): ",a),c.setBlockStatus("reconnect","warning"),c.updateFromCache("vyprvpn_reconnect"),c.enableFields(!0)},d,function(a){log.warn("Timeout in requestSetReconnect(). Gave up after "+a+" attempts."),c.setBlockStatus("reconnect","warning"),c.enableFields(!0)}),b&&(log.status("Saving reconnect setting..."),this.enableFields(!1))},VyprSettings.prototype.requestSetReconnectSelect=VyprSettings.prototype.requestSetReconnect,VyprSettings.prototype.requestSetReconnectCheckbox=VyprSettings.prototype.requestSetReconnect,VyprSettings.prototype.requestSetAnalytics=function(a){var b,c=this,d=!0;this.setBlockStatus("analytics","progress"),b=this.doRequest(["VYPRVPN_ANALYTICS",a?1:0],function(){var a=c.handleSetAnalyticsResponse.apply(c,arguments);a?c.setBlockStatus("analytics","success"):(c.setBlockStatus("analytics","warning"),c.updateFromCache("vyprvpn_analytics")),c.enableFields(!0)},function(a){log.error("Error in requestSetAnalytics(): ",a),c.setBlockStatus("analytics","warning"),c.updateFromCache("vyprvpn_analytics"),c.enableFields(!0)},d,function(a){log.warn("Timeout in requestSetAnalytics(). Gave up after "+a+" attempts."),c.setBlockStatus("analytics","warning"),c.enableFields(!0)}),b&&(log.status("Saving analytics setting..."),this.enableFields(!1))},VyprSettings.prototype.handleLogoutResponse=function(a){var b=this.parseResponse(a);return"FAIL"==b.res?void this.handleFailResponse(a):(log.success("Logout requested."),this.setCache("app_status","LOGGING_OUT"),this.handleStatus("LOGGING_OUT"),void 0)},VyprSettings.prototype.handleSetReconnectResponse=function(a){var b=this.parseResponse(a);return"FAIL"==b.res?(this.handleFailResponse(a),!1):(log.success("Set reconnection value."),!0)},VyprSettings.prototype.handleSetAnalyticsResponse=function(a){var b=this.parseResponse(a);return"FAIL"==b.res?(this.handleFailResponse(a),!1):(log.success("Set analytics value."),!0)},VyprSettings.prototype.handleAppUpgradeInfoResponse=function(a){var b=Vypr.prototype.handleAppUpgradeInfoResponse.apply(this,arguments),c=this.parseResponse(a);return b===!0&&this.populateApplicationDetails(c.data),b},VyprSettings.prototype.populateAccount=function(a){VyprElementHelper.setTextContent("vypr--logged-in-username",a)},VyprSettings.prototype.populateReconnect=function(a){var b=document.getElementById("vypr-setting-reconnect-limit"),c=document.getElementById("vypr-setting-reconnect"),d=function(a){var b=[];for(i=0;i<a.options.length;i++)b[i]=a.options[i].value;return b}(b);a>0?(a=d.getClosest(a),VyprElementHelper.setSelectedIndexByValue(b,a),this.setCache("reconnect",a),VyprElementHelper.setChecked(c,!0),log.info("Checking reconnect checkbox because a value is set.")):(a=this.getCache("reconnect")||0,VyprElementHelper.setSelectedIndexByValue(b,a),VyprElementHelper.setChecked(c,!1),log.info("Unchecking reconnect checkbox because no value is set."))},VyprSettings.prototype.populateReconnectSelect=VyprSettings.prototype.populateReconnect,VyprSettings.prototype.populateReconnectCheckbox=VyprSettings.prototype.populateReconnect,VyprSettings.prototype.populateAnalytics=function(a){var b=document.getElementById("vypr-setting-analytics");a?(b.checked=!0,b.setAttribute("checked","checked")):(b.checked=!1,b.removeAttribute("checked"))},Vypr.prototype.populateApplicationDetails=function(a){function b(a){c.messageSendToFramePage("vypr.dom.reset.iframe.dimensions",{options:a}),window.setTimeout(c.showChangelog.bind(c),750)}var c=this,d=document.getElementById("vypr-app-changelog"),e=this.getCache("app_version"),f=void 0!==a,g=!!f&&this.hasAppUpgradeAvailable(a.version),h={height:document.body.offsetHeight};f&&g?this.requestTemplate("changelog.html",d,function(){var d=g?b.bind(c,h):null;c.showApplicationDetails(e,a.version,a.willReboot,d)}):f?c.showApplicationDetails(e,a.version,a.willReboot):c.showApplicationDetails(e)},Vypr.prototype.showApplicationDetails=function(a,b,c,d){var e=c?"is-true":"is-false",f=c?"is-false":"is-true",g=document.getElementById("vypr--app-update-notice");VyprElementHelper.setTextContentMultiple([["vypr-app-version-latest",b||""],["vypr-app-version-current",a||""]]),VyprElementHelper.removeClass(g,f),VyprElementHelper.addClass(g,e),"function"==typeof d&&d()},Vypr.prototype.showChangelog=function(){var a=document.getElementById("vypr-app-changelog");VyprElementHelper.addClass(a,this.constants.className.active)},VyprSettings.prototype.getValueAnalytics=function(a){var b=a.checked?parseInt(a.value,10):0;return b},VyprSettings.prototype.getValueReconnect=function(a){var b=document.getElementById("vypr-setting-reconnect-limit"),c=document.getElementById("vypr-setting-reconnect"),d=parseInt(b.value.trim(),10),e=c.checked;return void 0===a&&log.error("Parameter `isCheckboxSignificant` is `"+a+"`."),a&&!e&&(d=0),d},VyprSettings.prototype.getValueReconnectSelect=function(){var a=!1,b=this.getValueReconnect(a);return b},VyprSettings.prototype.getValueReconnectCheckbox=function(){var a=!0,b=this.getValueReconnect(a);return b},VyprSettings.prototype.updateReconnect=function(){var a=this.getCache("reconnect");return void 0===a?void log.warn("No value for device configuration. Skipping udpate."):void this.populateReconnect(a)},VyprSettings.prototype.updateAnalytics=function(){var a=this.getCache("analytics");return void 0===a?void log.warn("No value for device configuration. Skipping udpate."):void this.populateAnalytics(a)},VyprSettings.prototype.verifyFields=function(a){var b=this,c=!1,d=!1,e=!1,f={reconnect:function(a){var c="checkbox"===a.getAttribute("type")?a.checked?parseInt(a.value,10):0:parseInt(a.value,10),d=b.constants.reconnect.indexOf(c)>-1;document.getElementById("vypr-setting-reconnect-block");return d?(b.clearInvalidClass(a),!0):(b.setInvalidClass(a,"Invalid reconnect setting."),!1)},analytics:function(a){var c=a.checked?parseInt(a.value,10):0,d=b.constants.analytics.indexOf(c)>-1;document.getElementById("vypr-setting-analytics-block");return d?(b.clearInvalidClass(a),!0):(b.setInvalidClass(a,"Invalid analytics setting."),!1)}};if(a){if(d=0===a.id.search("vypr-setting-reconnect"),e=0===a.id.search("vypr-setting-analytics"),d)return a=document.getElementById("vypr-setting-reconnect-limit"),c=f.reconnect(a),c||this.setBlockStatus("reconnect","warning"),c;if(e)return c=f.analytics(a),c||this.setBlockStatus("analytics","warning"),c}else a=document.getElementById("vypr-setting-reconnect-limit"),f.reconnect(a),a=document.getElementById("vypr-setting-analytics"),f.analytics(a);return!0},VyprSettings.prototype.setEventHandlers=function(){Vypr.prototype.setEventHandlers.apply(this);var a=this,b={buttonLogout:document.getElementById("vypr--logout-button"),settingAnalytics:document.getElementById("vypr-setting-analytics"),settingReconnectLimit:document.getElementById("vypr-setting-reconnect-limit"),settingReconnect:document.getElementById("vypr-setting-reconnect")},c=function(b,c){var e={get:"getValue"+c.capitalize(),request:"requestSet"+c.capitalize(),populate:"populate"+c.capitalize()},f=a[e.get](b),g=a.getCache("setting_"+c),h=a.verifyFields.apply(a,[b]);return h?(log.warn("Re-populating value for setting `"+c+"` (on select dropdown change, checks checkbox)."),a[e.populate](f),f===g?(log.warn("No change made to setting `"+c+"`. Aborting auto-save."),!1):(log.info("Saving setting `"+c+"`."),d.apply(a,arguments),void a[e.request].apply(a,[f]))):(log.warn("Using cached data for setting `"+c+"`."),f=g,a[e.populate](f),!1)},d=function(b,c){var d={get:"getValue"+c.capitalize()},e=a[d.get](b),f=a.verifyFields.apply(a,[b]);f&&a.setCache("setting_"+c,e)};b.buttonLogout.addEventListener("click",function(){a.requestLogout.apply(a)},!1),b.settingAnalytics.addEventListener("change",function(){c.apply(a,[this,"analytics"])},!1),b.settingAnalytics.addEventListener("focus",function(){d.apply(a,[this,"analytics"])},!1),b.settingReconnectLimit.addEventListener("change",function(){c.apply(a,[this,"reconnectSelect"])},!1),b.settingReconnectLimit.addEventListener("focus",function(){d.apply(a,[this,"reconnectSelect"])},!1),b.settingReconnect.addEventListener("change",function(){c.apply(a,[this,"reconnectCheckbox"])},!1),b.settingReconnect.addEventListener("focus",function(){d.apply(a,[this,"reconnectCheckbox"])},!1)},VyprSettings.prototype.init=function(){Vypr.prototype.init.apply(this,arguments);var a=this.getCache("user"),b=this.getCache("reconnect"),c=toBoolean(this.getCache("analytics"));this.populateAccount(a),this.populateReconnect(b),this.populateAnalytics(c),this.populateApplicationDetails(),this.requestAppUpgradeInfo()},VyprVPN=new VyprSettings,VyprVPN.init();