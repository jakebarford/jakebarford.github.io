function VyprSupport(){this.constants.log=[0,1],this.constants.msgCharLimit=1e3,this.constants.types=["error","crash","support","feedback"],this.constants.message={feedback:{error:{fail:"The router failed to send your message.",unknown:"An unexpected error occured sending your message."},success:"Message sent",warning:{message:"Your message is blank or exceeds the character limit.",email:"A valid email is required.",type:"The type chosen is invalid."}}},this.g_enable_fields_ids.push("vypr-support-form-name"),this.g_enable_fields_ids.push("vypr-support-form-email"),this.g_enable_fields_ids.push("vypr-support-form-type"),this.g_enable_fields_ids.push("vypr-support-form-log"),this.g_enable_fields_ids.push("vypr-support-form-message"),this.g_enable_fields_ids.push("vypr-support-form-button")}Array.prototype.every||(Array.prototype.every=function(a){"use strict";if(void 0===this||null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw new TypeError;for(var d=arguments.length>=2?arguments[1]:void 0,e=0;e<c;e++)if(e in b&&!a.call(d,b[e],e,b))return!1;return!0}),VyprSupport.prototype=new Vypr,VyprSupport.prototype.requestSendFeedback=function(a,b,c,d,e,f){function g(){var a=p.handleSendFeedbackResponse.apply(p,arguments);a?p.setVyprSuccess(this.constants.message.feedback.success,u):p.setVyprError(this.constants.message.feedback.error.fail,u),p.enableFields(!0),p.setFormButton(!0),this.updateFormName(""),this.updateFormEmail(""),this.updateFormType(""),this.updateFormLog(!0),this.updateFormMessage(""),window.clearTimeout(l),window.clearTimeout(m),window.clearTimeout(n),this.startGetStatus()}function h(a){log.warn("Error in requestSendFeedback(): ",a)}function i(){log.warn("Request taking longer than expected."),window.clearTimeout(n)}function j(){log.warn("Retrying request."),p.requestSendFeedback.apply(p,[a,b,c,d,e,!0]),window.clearTimeout(m)}function k(){log.warn("Timeout in requestSendFeedback(). Giving up."),p.setVyprError(p.constants.message.feedback.error.unknown,u),p.enableFields(!0),p.setFormButton(!0),window.clearTimeout(l),this.startGetStatus()}var l,m,n,o,p=this,q=!1,r=10,s=r,t=r/2,u=document.getElementById("vypr-feedback-form");o=this.doRequest(["VYPRVPN_FEEDBACK",a,b,c,d,e],g,h,q),n=window.setTimeout(i.bind(this),1e3*t),f===!0?l=window.setTimeout(k.bind(this),1e3*r):m=window.setTimeout(j.bind(this),1e3*s),o&&(this.stopGetStatus(),this.enableFields(!1),this.setFormButton(!1),this.clearMessages(),this.setCache("form_name",data.name),this.setCache("form_email",data.email),this.setCache("form_type",data.type),this.setCache("form_log",data.log),this.setCache("form_message",data.message),log.status("Sending message to support..."))},VyprSupport.prototype.handleSendFeedbackResponse=function(a){var b=this.parseResponse(a);return"FAIL"==b.res?(this.handleFailResponse(a),!1):(log.success("Sent feedback."),!0)},VyprSupport.prototype.setFormButton=function(a){var b=document.getElementById("vypr-feedback-form-buttonwrap");a?(VyprElementHelper.addClass(b,"is-true"),VyprElementHelper.removeClass(b,"is-false")):(VyprElementHelper.addClass(b,"is-false"),VyprElementHelper.removeClass(b,"is-true"))},VyprSupport.prototype.initFormMessage=function(){var a=document.getElementById("vypr-support-form-message");a.setAttribute("maxLength",this.constants.msgCharLimit)},VyprSupport.prototype.updateFormName=function(a){a=void 0!=a?a:this.getCache("form_name"),document.getElementById("vypr-support-form-name").value=a},VyprSupport.prototype.updateFormEmail=function(a){a=void 0!=a?a:this.getCache("form_email"),document.getElementById("vypr-support-form-email").value=a},VyprSupport.prototype.updateFormType=function(a){a=void 0!=a?a:this.getCache("form_type"),VyprElementHelper.setSelectedIndexByValue(document.getElementById("vypr-support-form-type"),a)},VyprSupport.prototype.updateFormLog=function(a){a=void 0!=a?a:this.getCache("form_log"),a="string"==typeof a?parseInt(a,10):a,VyprElementHelper.setChecked(document.getElementById("vypr-support-form-log"),Boolean(a))},VyprSupport.prototype.updateFormMessage=function(a){a=void 0!=a?a:this.getCache("form_message"),document.getElementById("vypr-support-form-message").value=a},VyprSupport.prototype.verifyFields=function(a){var b=this,a=a;if(isValid=!1,isReconnect=!1,isAnalytics=!1,validationMethods={message:function(a){var c=a.value.trim(),d=b.isValidMessage(c);return d?b.clearInvalidClass(a):b.setInvalidClass(a,"Invalid message."),d},email:function(a){var c=a.value.trim(),d=b.isValidEmail(c);return d?b.clearInvalidClass(a):b.setInvalidClass(a,"Invalid email."),d},type:function(a){var c=a.value.trim(),d=b.isValidType(c);return d?b.clearInvalidClass(a):b.setInvalidClass(a,"Invalid type."),d}},a){if(isMessage=0===a.id.search("vypr-support-form-message"),isEmail=0===a.id.search("vypr-support-form-email"),isType=0===a.id.search("vypr-support-form-type"),isMessage)return isValid=validationMethods.message(a),isValid||this.setElementStatus(a,"warning"),isValid;if(isEmail)return isValid=validationMethods.email(a),isValid||this.setElementStatus(a,"warning"),isValid;if(isType)return isValid=validationMethods.type(a),isValid||this.setElementStatus(a,"warning"),isValid}else a=document.getElementById("vypr-support-form-message"),validationMethods.message(a),a=document.getElementById("vypr-support-form-log"),validationMethods.log(a);return!0},VyprSupport.prototype.isValidMessage=function(a){var b=a.length>0&&a.length<=this.constants.msgCharLimit;return b},VyprSupport.prototype.isValidEmail=function(a){var b=this.getCache("app_status"),c=["INVALID_STATE","INVALID_REQUEST","OFFLINE","INITIALIZING","STOPPING","NOT_LOGGED_IN","LOGGING_IN"],d=(c.every(function(a){return b!==a}),a),e=/.+@.+\..+/i.test(a),f=e&&d;return f},VyprSupport.prototype.isValidType=function(a){var b=this.constants.types.indexOf(a)>-1;return b},VyprSupport.prototype.setEventHandlers=function(){Vypr.prototype.setEventHandlers.apply(this);var a=this,b={buttonSend:document.getElementById("vypr-support-form-button")};b.buttonSend.addEventListener("click",function(b){b.preventDefault(),a.handleFormSend.apply(a)},!1),this.handleFieldFocus()},VyprSupport.prototype.handleFormSend=function(){var a={message:document.getElementById("vypr-support-form-message"),type:document.getElementById("vypr-support-form-type"),email:document.getElementById("vypr-support-form-email"),name:document.getElementById("vypr-support-form-name"),log:document.getElementById("vypr-support-form-log"),form:document.getElementById("vypr-feedback-form")},b={message:a.message.value.trim(),email:a.email.value.trim(),name:a.name.value.trim(),type:a.type.options[a.type.selectedIndex].value.trim(),log:a.log.checked?1:0},c={message:this.verifyFields(a.message),email:this.verifyFields(a.email),type:this.verifyFields(a.type)},d=document.getElementById("vypr-feedback-form");this.clearMessages(d),c.message||(this.addMessageWarning(this.constants.message.feedback.warning.message,d,a.message.id),log.warn("Invalid form data: message")),c.email||(this.addMessageWarning(this.constants.message.feedback.warning.email,d,a.email.id),log.warn("Invalid form data: email")),c.type||(this.addMessageWarning(this.constants.message.feedback.warning.type,d,a.type.id),log.warn("Invalid form data: type")),c.message&&c.email&&c.type&&this.requestSendFeedback(b.message,b.log,b.type,b.email,b.name)},Vypr.prototype.handleFieldFocus=function(){for(var a=this,b=document.getElementById("vypr-feedback-form"),c=b.querySelectorAll('[data-vypr-role="field"]'),d=0;d<c.length;++d){var e=c[d];e.addEventListener("change",function(c){a.removeMessage(this.id,b)},!1)}},VyprSupport.prototype.init=function(){Vypr.prototype.init.apply(this,arguments),this.updateFormLog(!0),this.setFormButton(!0),this.initFormMessage()},VyprVPN=new VyprSupport,VyprVPN.init();